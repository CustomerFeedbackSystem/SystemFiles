if(window.GUnload)Ojay(window).on('unload',GUnload);if(window.GMap2)JS.MethodChain.addMethods(GMap2);LocationPicker=new JS.Class({extend:{WIDTH:600,HEIGHT:400,CONTAINER_CLASS:'location-picker',DEFAULT_LATITUDE:51.498945,DEFAULT_LONGITUDE:-0.080874,ZOOM_LEVEL:15,PRECISION:6,round:function(a){var b=Math.pow(10,this.PRECISION);return Math.round(a*b)/b},getGeocoder:function(){return this._9=this._9||new GClientGeocoder()}},initialize:function(c,d,e){this._3=Ojay(Ojay.HTML.div({className:this.klass.CONTAINER_CLASS}));this._4=e||{};this._5={};this._6=Ojay(this._4.latField).node;this._7=Ojay(this._4.lngField).node;Ojay(d).insert(this.getHTML(),c);this._0=new GMap2(this._5._0.node);this._0.enableScrollWheelZoom();this._0.enableContinuousZoom();this._0.disableDoubleClickZoom();this._0.addControl(new GSmallMapControl());GEvent.addListener(this._0,'dblclick',function(a,b){this._2=b;this.positionMarker()}.bind(this));this.pullLocation()},getHTML:function(){var c=this._5;if(c._3)return c._3;c._3=Ojay(Ojay.HTML.div({className:this.klass.CONTAINER_CLASS},function(b){c._a=Ojay(b.form(function(a){c._8=a.input({type:'text'});c._b=Ojay(a.button('Search'))}));c._0=Ojay(b.div())}));c._0.setStyle({width:(this._4.width||this.klass.WIDTH)+'px',height:(this._4.height||this.klass.HEIGHT)+'px'});c._a.on('submit',Ojay.stopDefault)._(this).search();return c._3},pullLocation:function(){var a=(this._6||{}).value,b=(this._7||{}).value;if(!a)a=this.klass.DEFAULT_LATITUDE;if(!b)b=this.klass.DEFAULT_LONGITUDE;this._2=new GLatLng(Number(a),Number(b));this._0.setCenter(this._2,this.klass.ZOOM_LEVEL);this.positionMarker()},pushLocation:function(){var a=this._1.getLatLng();(this._6||{}).value=this.klass.round(a.lat());(this._7||{}).value=this.klass.round(a.lng())},getMarker:function(){if(this._1)return this._1;this._1=new GMarker(this._2,{draggable:true});this._1.enableDragging();GEvent.addListener(this._1,'dragend',this.method('pushLocation'));this._0.addOverlay(this._1);return this._1},positionMarker:function(){this.getMarker().setLatLng(this._2);this.pushLocation()},search:function(f){if(f)this.setAddress(f);this.klass.getGeocoder().getLocations(this.getAddress(),function(a){var b=a.Placemark[0];if(!b)return;var c=b.Point.coordinates,d=b.ExtendedData.LatLonBox,e=new GLatLngBounds(new GLatLng(d.south,d.west),new GLatLng(d.north,d.east)),g=this._0.getBoundsZoomLevel(e);this._2=new GLatLng(c[1],c[0]);this._0.setCenter(this._2,g);this.positionMarker()}.bind(this))},getAddress:function(){return this._5._8.value},setAddress:function(a){this._5._8.value=a}});